jQuery.fn.extend({
    circliful: function(con) {
        var arrList = [];
        function shenchao($canvas,config){
            this.dateTime = "";
            var that = this;
            this.intervalTime =function(){
                that.dateTime = setInterval(function(){
                    that.start();
                },20);
            }
            this.start =function(){
                var context = $canvas.get(0).getContext('2d');

                var speed=parseFloat($canvas.attr("speen"));
                var num=parseFloat($canvas.attr("num"));
                var sum=parseFloat($canvas.attr("sum"));
                var objWidth = $canvas.width();
                var objHeight = $canvas.height();
                if($canvas.attr("width") != ""){
                    objWidth = $canvas.attr("width");
                }
                if($canvas.attr("height") != ""){
                    objHeight = $canvas.attr("height");
                }
                var min = objWidth>objHeight?objHeight:objWidth;
                var per = Math.ceil((num-speed)/14);
                var lineWidth = 17;
                per = speed + per;
                $canvas.attr("speen",per);
                per = per/sum;
                context.clearRect(0,0,objWidth,objHeight);
                context.lineWidth=lineWidth+2;
                context.strokeStyle="#D7D8DD";
                context.beginPath();
                // 画圆,圆心是24,24,半径24,从角度0开始,画到2PI结束,最后一个参数是方向顺时针还是逆时针
                context.arc(Math.floor(objWidth/2), Math.floor(objHeight/2), Math.floor(min/2)-lineWidth-5,0 ,2*Math.PI, false);
                context.stroke();

                context.lineWidth=lineWidth;
                context.strokeStyle=config["color"];
                context.beginPath();
                per = 2*Math.PI* per - 0.5*Math.PI;
                if(per == 1.5*Math.PI){
                    per = -0.5*Math.PI;
                }
                // 画圆,圆心是24,24,半径24,从角度0开始,画到2PI结束,最后一个参数是方向顺时针还是逆时针
                context.arc(Math.floor(objWidth/2), Math.floor(objHeight/2), Math.floor(min/2)-lineWidth-5, 1.5*Math.PI,per, false);
                context.stroke();
                if(speed == num){
                    clearInterval(that.dateTime);
                }
            }
        }
        return this.each(function() {
            var $obj = $(this);
            var config = [];
            $(this).attr("speen",0);
            if(con == null){
                if($(this).attr("color") == null){
                    config["color"] = "blue";
                }else{
                    config["color"] = $(this).attr("color");
                }
            }else{
                config = con;
            }
            var objCircliful = new shenchao($obj,config);
            objCircliful.intervalTime();
        });
    }

});
